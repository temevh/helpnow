//npx prisma migrate dev --name [migration name]
//npx prisma migrate reset

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         String      @id @default(uuid())
  username   String      @unique
  email      String      @unique
  password   String
  firstName  String
  lastName   String
  posts      Post[]      @relation("UserPosts") //Posts created by the user
  volunteers Volunteer[] // volunteer actions by this user
  createdAt  DateTime    @default(now())
}

model Post {
  id                String      @id @default(uuid())
  name              String
  description       String?
  address           String //Address of the post
  country           String
  region            String
  postcode          String
  latitude          Float
  longitude         Float
  taskTime          DateTime
  locationReveal    DateTime
  creator           User        @relation("UserPosts", fields: [userId], references: [id])
  userId            String
  volunteers        Volunteer[] // volunteers on this post
  volunteersNeeded  Int         @default(1) //Amount of volunteers needed by the post
  volunteersAlready Int         @default(0) //Amount of volunteers the post already has
  status            PostStatus
  createdAt         DateTime    @default(now())
  reward            Int         @default(0)
}

model Volunteer {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  post      Post     @relation(fields: [postId], references: [id])
  postId    String
  accepted  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@unique([userId, postId]) // prevent duplicate volunteering
}

enum PostStatus {
  OPEN
  ACCEPTED
  COMPLETED
  CLOSED
  FILLED
}
